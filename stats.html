<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –ü—Ä–∞–Ω–∞—è–º–∞ –ù–∞–¥–∏ –®–æ–¥—Ö–∞–Ω–∞</title>
	<style>
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		body {
			background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
			min-height: 100vh;
			padding: 20px;
		}

		.container {
			max-width: 800px;
			margin: 0 auto;
			background: white;
			border-radius: 20px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
			padding: 30px;
		}

		.header {
			text-align: center;
			margin-bottom: 30px;
		}

		h1 {
			color: #2c3e50;
			margin-bottom: 10px;
		}

		.subtitle {
			color: #7f8c8d;
			font-size: 16px;
		}

		.nav-buttons {
			display: flex;
			gap: 10px;
			margin-bottom: 30px;
			justify-content: center;
		}

		.nav-btn {
			padding: 10px 20px;
			border: none;
			border-radius: 10px;
			background: #3498db;
			color: white;
			text-decoration: none;
			font-size: 14px;
			transition: all 0.3s ease;
		}

		.nav-btn:hover {
			background: #2980b9;
			transform: translateY(-2px);
		}

		.nav-btn.active {
			background: #2c3e50;
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}

		.stat-card {
			background: #f8f9fa;
			padding: 20px;
			border-radius: 15px;
			text-align: center;
			border-left: 4px solid #3498db;
		}

		.stat-value {
			font-size: 32px;
			font-weight: bold;
			color: #2c3e50;
			margin-bottom: 5px;
		}

		.stat-label {
			font-size: 14px;
			color: #7f8c8d;
		}

		.history-section {
			margin-top: 30px;
		}

		.section-title {
			font-size: 20px;
			color: #2c3e50;
			margin-bottom: 20px;
			padding-bottom: 10px;
			border-bottom: 2px solid #ecf0f1;
		}

		.history-list {
			max-height: 400px;
			overflow-y: auto;
		}

		.history-item {
			background: #f8f9fa;
			padding: 15px;
			border-radius: 10px;
			margin-bottom: 10px;
			border-left: 4px solid #2ecc71;
		}

		.history-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 8px;
		}

		.history-date {
			font-weight: bold;
			color: #2c3e50;
		}

		.history-duration {
			background: #3498db;
			color: white;
			padding: 4px 8px;
			border-radius: 12px;
			font-size: 12px;
		}

		.history-details {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 10px;
			font-size: 14px;
			color: #7f8c8d;
		}

		.detail-item {
			text-align: center;
		}

		.detail-value {
			font-weight: bold;
			color: #2c3e50;
		}

		.no-data {
			text-align: center;
			color: #7f8c8d;
			padding: 40px;
			font-style: italic;
		}

		.clear-btn {
			background: #e74c3c;
			color: white;
			border: none;
			padding: 10px 20px;
			border-radius: 10px;
			cursor: pointer;
			margin-top: 20px;
			transition: all 0.3s ease;
		}

		.clear-btn:hover {
			background: #c0392b;
		}

		.charts-section {
			margin-top: 30px;
		}

		.chart-container {
			background: #f8f9fa;
			padding: 20px;
			border-radius: 15px;
			margin-bottom: 20px;
		}

		@media (max-width: 768px) {
			.container {
				padding: 20px;
			}

			.stats-grid {
				grid-template-columns: 1fr;
			}

			.history-details {
				grid-template-columns: repeat(2, 1fr);
			}

			.nav-buttons {
				flex-direction: column;
			}
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="header">
			<h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
		</div>

		<div class="nav-buttons">
			<a href="/" class="nav-btn">üè† –¢–∞–π–º–µ—Ä</a>
		</div>

		<div class="stats-grid" id="statsGrid">
			<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
		</div>

		<div class="charts-section">
			<h2 class="section-title">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å</h2>
			<div class="chart-container">
				<canvas id="progressChart"></canvas>
			</div>
		</div>

		<div class="history-section">
			<h2 class="section-title">üìù –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
			<div class="history-list" id="historyList">
				<!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
			</div>
			<button class="clear-btn" onclick="clearHistory()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
		</div>
	</div>

	<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<script>
		// –ö–ª—é—á –¥–ª—è localStorage
		const HISTORY_KEY = 'pranayama_history';

		// –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
		document.addEventListener('DOMContentLoaded', function () {
			loadStatistics();
			loadHistory();
			renderCharts();
		});

		// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
		function loadStatistics() {
			const history = getHistory();
			const statsGrid = document.getElementById('statsGrid');

			if (history.length === 0) {
				statsGrid.innerHTML = '<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>';
				return;
			}

			const totalSessions = history.length;
			const totalCycles = history.reduce((sum, session) => sum + session.cycles, 0);
			const totalDuration = history.reduce((sum, session) => sum + session.totalDuration, 0);

			// –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—É—é –¥–ª–∏–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
			const longestSession = history.reduce((max, session) =>
				session.totalDuration > max.totalDuration ? session : max, history[0]);

			// –°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
			const avgInhale = Math.round(history.reduce((sum, session) => sum + session.inhale, 0) / totalSessions);
			const avgHold = Math.round(history.reduce((sum, session) => sum + session.hold, 0) / totalSessions);
			const avgExhale = Math.round(history.reduce((sum, session) => sum + session.exhale, 0) / totalSessions);

			statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalSessions}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalCycles}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ü–∏–∫–ª–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Math.round(totalDuration / 60)}</div>
                    <div class="stat-label">–ú–∏–Ω—É—Ç –ø—Ä–∞–∫—Ç–∏–∫–∏</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${formatTime(longestSession.totalDuration)}</div>
                    <div class="stat-label">–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${avgInhale}-${avgHold}-${avgExhale}</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${getLast7DaysSessions(history)}</div>
                    <div class="stat-label">–ó–∞ 7 –¥–Ω–µ–π</div>
                </div>
            `;
		}

		// –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
		function loadHistory() {
			const history = getHistory();
			const historyList = document.getElementById('historyList');

			if (history.length === 0) {
				historyList.innerHTML = '<div class="no-data">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø—É—Å—Ç–∞</div>';
				return;
			}

			// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
			history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

			historyList.innerHTML = history.map(session => `
                <div class="history-item">
                    <div class="history-header">
                        <div class="history-date">${formatDate(session.timestamp)}</div>
                        <div class="history-duration">${formatTime(session.totalDuration)}</div>
                    </div>
                    <div class="history-details">
                        <div class="detail-item">
                            <div>–í–¥–æ—Ö</div>
                            <div class="detail-value">${session.inhale}—Å</div>
                        </div>
                        <div class="detail-item">
                            <div>–ó–∞–¥–µ—Ä–∂–∫–∞</div>
                            <div class="detail-value">${session.hold}—Å</div>
                        </div>
                        <div class="detail-item">
                            <div>–í—ã–¥–æ—Ö</div>
                            <div class="detail-value">${session.exhale}—Å</div>
                        </div>
                        <div class="detail-item">
                            <div>–¶–∏–∫–ª—ã</div>
                            <div class="detail-value">${session.cycles}</div>
                        </div>
                    </div>
                </div>
            `).join('');
		}

		// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä–∞—Ñ–∏–∫–æ–≤
		function renderCharts() {
			const history = getHistory();

			if (history.length === 0) {
				document.querySelector('.charts-section').style.display = 'none';
				return;
			}

			// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–Ω—è–º –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
			const last7Days = getLast7DaysData(history);
			const ctx = document.getElementById('progressChart').getContext('2d');

			new Chart(ctx, {
				type: 'line',
				data: {
					labels: last7Days.labels,
					datasets: [{
						label: '–ú–∏–Ω—É—Ç –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤ –¥–µ–Ω—å',
						data: last7Days.data,
						borderColor: '#3498db',
						backgroundColor: 'rgba(52, 152, 219, 0.1)',
						borderWidth: 2,
						fill: true,
						tension: 0.4
					}]
				},
				options: {
					responsive: true,
					plugins: {
						legend: {
							position: 'top',
						},
						title: {
							display: true,
							text: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π'
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							title: {
								display: true,
								text: '–ú–∏–Ω—É—Ç'
							}
						}
					}
				}
			});
		}

		// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
		function getHistory() {
			return JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
		}

		function formatTime(seconds) {
			const mins = Math.floor(seconds / 60);
			const secs = seconds % 60;
			return `${mins}:${secs.toString().padStart(2, '0')}`;
		}

		function formatDate(timestamp) {
			const date = new Date(timestamp);
			return date.toLocaleDateString('ru-RU', {
				day: '2-digit',
				month: '2-digit',
				year: 'numeric',
				hour: '2-digit',
				minute: '2-digit'
			});
		}

		function getLast7DaysSessions(history) {
			const sevenDaysAgo = new Date();
			sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
			return history.filter(session => new Date(session.timestamp) >= sevenDaysAgo).length;
		}

		function getLast7DaysData(history) {
			const result = {
				labels: [],
				data: []
			};

			for (let i = 6; i >= 0; i--) {
				const date = new Date();
				date.setDate(date.getDate() - i);
				date.setHours(0, 0, 0, 0);

				const nextDate = new Date(date);
				nextDate.setDate(nextDate.getDate() + 1);

				const daySessions = history.filter(session => {
					const sessionDate = new Date(session.timestamp);
					return sessionDate >= date && sessionDate < nextDate;
				});

				const dayMinutes = Math.round(daySessions.reduce((sum, session) =>
					sum + session.totalDuration, 0) / 60);

				result.labels.push(date.toLocaleDateString('ru-RU', { weekday: 'short', day: 'numeric' }));
				result.data.push(dayMinutes);
			}

			return result;
		}

		function clearHistory() {
			if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫?')) {
				localStorage.removeItem(HISTORY_KEY);
				loadStatistics();
				loadHistory();
				renderCharts();
			}
		}
	</script>
</body>

</html>